#include "gpu.h"
#include "log.h"

void gp0_cmd_nop(Gpu *gpu) {
  command_fifo_pop(&gpu->fifo);
}

void gp0_cmd_unimplemented(Gpu *gpu) {
  uint32_t ins = command_fifo_pop(&gpu->fifo);
  fatal("GP0 Command unimplemented: Opcode: 0x%02X, Command: 0x%08X", ins >> 24, ins);
}

Gp0Command const gp0_handlers[0x100] = {
  // 0x00
  MAKE_Gp0Command(gp0_cmd_nop, 1, 1, true),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_nop, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_nop, 1, 1, true),
  MAKE_Gp0Command(gp0_cmd_nop, 1, 1, true),
  MAKE_Gp0Command(gp0_cmd_nop, 1, 1, true),
  MAKE_Gp0Command(gp0_cmd_nop, 1, 1, true),
  MAKE_Gp0Command(gp0_cmd_nop, 1, 1, true),
  MAKE_Gp0Command(gp0_cmd_nop, 1, 1, true),
  MAKE_Gp0Command(gp0_cmd_nop, 1, 1, true),
  MAKE_Gp0Command(gp0_cmd_nop, 1, 1, true),
  MAKE_Gp0Command(gp0_cmd_nop, 1, 1, true),
  MAKE_Gp0Command(gp0_cmd_nop, 1, 1, true),
  MAKE_Gp0Command(gp0_cmd_nop, 1, 1, true),
  MAKE_Gp0Command(gp0_cmd_nop, 1, 1, true),
  // 0x10
  MAKE_Gp0Command(gp0_cmd_nop, 1, 1, true),
  MAKE_Gp0Command(gp0_cmd_nop, 1, 1, true),
  MAKE_Gp0Command(gp0_cmd_nop, 1, 1, true),
  MAKE_Gp0Command(gp0_cmd_nop, 1, 1, true),
  MAKE_Gp0Command(gp0_cmd_nop, 1, 1, true),
  MAKE_Gp0Command(gp0_cmd_nop, 1, 1, true),
  MAKE_Gp0Command(gp0_cmd_nop, 1, 1, true),
  MAKE_Gp0Command(gp0_cmd_nop, 1, 1, true),
  MAKE_Gp0Command(gp0_cmd_nop, 1, 1, true),
  MAKE_Gp0Command(gp0_cmd_nop, 1, 1, true),
  MAKE_Gp0Command(gp0_cmd_nop, 1, 1, true),
  MAKE_Gp0Command(gp0_cmd_nop, 1, 1, true),
  MAKE_Gp0Command(gp0_cmd_nop, 1, 1, true),
  MAKE_Gp0Command(gp0_cmd_nop, 1, 1, true),
  MAKE_Gp0Command(gp0_cmd_nop, 1, 1, true),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  // 0x20
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  // 0x30
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  // 0x40
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  // 0x50
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  // 0x60
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  // 0x70
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  // 0x80
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  // 0x90
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  // 0xA0
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  // 0xB0
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  // 0xC0
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  // 0xD0
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  // 0xE0
  MAKE_Gp0Command(gp0_cmd_nop, 1, 1, true),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_nop, 1, 1, true),
  MAKE_Gp0Command(gp0_cmd_nop, 1, 1, true),
  MAKE_Gp0Command(gp0_cmd_nop, 1, 1, true),
  MAKE_Gp0Command(gp0_cmd_nop, 1, 1, true),
  MAKE_Gp0Command(gp0_cmd_nop, 1, 1, true),
  MAKE_Gp0Command(gp0_cmd_nop, 1, 1, true),
  MAKE_Gp0Command(gp0_cmd_nop, 1, 1, true),
  MAKE_Gp0Command(gp0_cmd_nop, 1, 1, true),
  MAKE_Gp0Command(gp0_cmd_nop, 1, 1, true),
  // 0xF0
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
  MAKE_Gp0Command(gp0_cmd_unimplemented, 1, 1, false),
};
